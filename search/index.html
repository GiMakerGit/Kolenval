<!DOCTYPE html>
    <html lang="ua">   
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Outfit&family=Reem+Kufi&display=swap" rel="stylesheet">
            <title>Коленвали</title>
            <link rel="stylesheet" href="../css/light.css">
        </head>
        <body>
            <header class="header">
                <div class="leftheader">
                    <div class="leftheader">
                    <img src="../logo.png" alt="logo" class="logo" width="20" height="20">
                    <a href="../" class="logotext">Kolenval</a>
                    <nav class="nav">
                        <a href="../" class="nav-link">Головна</a>
                        <a href="/about/" class="nav-link">Про нас</a>
                        <a href="/payment_and_delivery/" class="nav-link">Оплата і доставка</a>
                        <a href="/contacts/" class="nav-link">Контакти</a>
                        <a href="/warranty/" class="nav-link">Гарантія</a>
                        <a href="/info/" class="nav-link">Інформація</a>
                    </nav>
                    </div>
                </div>
                <div class="search-container">
                    <input type="text" id="searchBox" placeholder="Пошук...">
                    <ul id="results"></ul>
                </div>
            </header>
            <div class="container">


                <main>
                    <div class="results">
                        <h2>Результати пошуку</h2>
                        <div class="product-gallery" id="productGallery">
                        </div>
                    </div>
                </main>

<!--                <footer>
                    <p>&copy; 2025 Kolenval </p>
                </footer> -->
            </div>

            <script>
                let products = [];

                // Load products JSON
                fetch("../products.json")
                    .then(res => res.json())
                    .then(data => {
                    products = data.products; // use 'products' array
                    initSearchFromURL();
                    });

                const searchBox = document.getElementById("searchBox");
                const results = document.getElementById("results");

                // Initially hide dropdown
                results.style.display = "none";

                // Show dropdown results
                function showResults(query) {
                    results.innerHTML = "";

                    if (!query) {
                    results.style.display = "none"; // hide when no search
                    return;
                    }

                    const filtered = products.filter(p =>
                    p.name.toLowerCase().includes(query.toLowerCase()) ||
                    p.category.toLowerCase().includes(query.toLowerCase())
                    );

                    if (filtered.length === 0) {
                    const li = document.createElement("li");
                    li.textContent = "No products found";
                    results.appendChild(li);
                    results.style.display = "block";
                    return;
                    }

                    filtered.forEach(p => {
                    const li = document.createElement("li");
                    li.innerHTML = `<strong>${p.name}</strong> - ${p.price} <em>(${p.category})</em>`;
                    li.addEventListener("click", () => {
                        window.location.href = `/product?q=${encodeURIComponent(p.name)}`;
                    });
                    results.appendChild(li);
                    });

                    results.style.display = "block"; // show dropdown when we have results
                }

                // Typing → live dropdown
                searchBox.addEventListener("input", () => {
                    const query = searchBox.value.trim();
                    showResults(query);

                    if (query) {
                    history.replaceState(null, "", `/search?q=${encodeURIComponent(query)}`);
                    } else {
                    history.replaceState(null, "", `/search`);
                    }
                });

                // Press Enter → go to /search?q=...
                searchBox.addEventListener("keydown", (e) => {
                    if (e.key === "Enter") {
                    e.preventDefault();
                    const query = searchBox.value.trim();
                    if (query) {
                        window.location.href = `/search?q=${encodeURIComponent(query)}`;
                    }
                    }
                });

                // On page load: fill search box from URL and show results
                function initSearchFromURL() {
                    const params = new URLSearchParams(window.location.search);
                    const q = params.get("q");
                    if (q) {
                    searchBox.value = q;
                    showResults(q);
                    }
                }

                // Close dropdown if clicked outside
                document.addEventListener("click", (e) => {
                    if (!document.querySelector(".search-container").contains(e.target)) {
                    results.style.display = "none"; // hide dropdown
                    }
                });
            </script>

        </body>
    </html>